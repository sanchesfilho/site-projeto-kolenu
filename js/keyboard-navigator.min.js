// PLATAFORMA WEB – ONG
// DESENVOLVIDO POR: JAYME SANCHES FILHO
// INSTITUIÇÃO: UNIVERSIDADE CRUZEIRO DO SUL
// DISCIPLINA: DESENVOLVIMENTO FRONT—END PARA WEB
// EXPERIÊNCIA PRÁTICA — ENTREGA 4 (VERSIONAMENTO, ACESSIBILIDADE E DEPLOY)
// DATA: 04/11/2025

// KEYBOARD-NAVIGATOR.JS: SISTEMA DE NAVEGAÇÃO POR TECLADO — IMPLEMENTA ACESSIBILIDADE WCAG E NAVEGAÇÃO KEYBOARD-ONLY

class KeyboardNavigation{constructor(){this.currentDropdown=null,this.isModalOpen=!1,this.init()}init(){this.setupSkipLink(),this.setupDropdownNavigation(),this.setupDropdownMenuNavigation(),this.setupModalNavigation(),this.setupAlertNavigation(),this.setupFormNavigation(),this.setupGlobalKeyboardEvents(),console.log("✅ SISTEMA DE NAVEGA\xc7\xc3O POR TECLADO INICIALIZADO")}setupSkipLink(){if(!document.querySelector(".skip-link")){let e=document.createElement("a");e.href="#main-content",e.className="skip-link",e.textContent="Ir para o conte\xfado principal",e.style.cssText=`
                position: absolute;
                top: -40px;
                left: 6px;
                background: #000;
                color: white;
                padding: 8px;
                z-index: 10000;
                text-decoration: none;
            `,document.body.prepend(e)}let t=document.querySelector(".skip-link");t&&t.addEventListener("click",e=>{e.preventDefault();let t=document.getElementById("app")||document.querySelector("main");t&&(t.hasAttribute("tabindex")||t.setAttribute("tabindex","-1"),t.focus(),t.scrollIntoView({behavior:"smooth"}))})}setupDropdownNavigation(){document.addEventListener("keydown",e=>{if(this.isModalOpen)return;let t=e.target,o=t.classList.contains("dropdown-toggle"),a=t.closest(".dropdown-menu"),n=t.closest(".dropdown");if(["Enter"," ","ArrowDown","ArrowUp","Escape"].includes(e.key)){if(("Enter"===e.key||" "===e.key)&&o){e.preventDefault(),e.stopPropagation(),this.toggleDropdown(n);return}if("ArrowDown"===e.key&&o){e.preventDefault(),e.stopPropagation(),this.openDropdown(n),setTimeout(()=>this.focusFirstMenuItem(n),50);return}if("ArrowUp"===e.key&&o){e.preventDefault(),e.stopPropagation(),this.openDropdown(n),setTimeout(()=>this.focusLastMenuItem(n),50);return}if("Escape"===e.key&&(o||a)){e.preventDefault(),e.stopPropagation(),this.closeCurrentDropdown();return}}}),document.addEventListener("click",e=>{e.target.closest(".dropdown")||this.closeAllDropdowns()}),window.addEventListener("hashchange",()=>{this.closeAllDropdowns()})}setupDropdownMenuNavigation(){document.addEventListener("keydown",e=>{let t=e.target,o="A"===t.tagName&&t.closest(".dropdown-menu");if(!o)return;let a=t.closest(".dropdown-menu"),n=a.closest(".dropdown"),r=Array.from(a.querySelectorAll("a")),i=r.indexOf(t);switch(e.key){case"ArrowDown":e.preventDefault(),e.stopPropagation();let s=(i+1)%r.length;r[s].focus();break;case"ArrowUp":e.preventDefault(),e.stopPropagation();let l=(i-1+r.length)%r.length;r[l].focus();break;case"Home":e.preventDefault(),e.stopPropagation(),r[0].focus();break;case"End":e.preventDefault(),e.stopPropagation(),r[r.length-1].focus();break;case"Escape":e.preventDefault(),e.stopPropagation(),this.closeDropdown(n);let d=n.querySelector(".dropdown-toggle");d&&d.focus();break;case"Tab":setTimeout(()=>{n.contains(document.activeElement)||this.closeDropdown(n)},10)}})}setupModalNavigation(){let e=document.querySelector(".modal-btn"),t=document.querySelector(".modal-overlay"),o=document.querySelector(".modal-close"),a=document.querySelector("#modal-toggle");e&&t&&(e.addEventListener("click",()=>{this.openModal()}),e.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),this.openModal())}),o&&(o.addEventListener("click",()=>{this.closeModal()}),o.addEventListener("keydown",e=>{("Enter"===e.key||" "===e.key)&&(e.preventDefault(),this.closeModal())})),a&&a.addEventListener("change",e=>{e.target.checked||this.closeModal()}),t.addEventListener("click",e=>{e.target===t&&this.closeModal()}),t.addEventListener("keydown",e=>{if("Tab"===e.key&&this.isModalOpen){let o=t.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');if(0===o.length)return;let a=o[0],n=o[o.length-1];e.shiftKey?document.activeElement===a&&(e.preventDefault(),n.focus()):document.activeElement===n&&(e.preventDefault(),a.focus())}}),document.addEventListener("keydown",e=>{"Escape"===e.key&&this.isModalOpen&&(e.preventDefault(),this.closeModal())}))}openModal(){let e=document.querySelector(".modal-btn"),t=document.querySelector(".modal-overlay"),o=document.querySelector("#modal-toggle"),a=document.querySelector(".modal-close");o?o.checked=!0:t.style.display="flex",e.setAttribute("aria-expanded","true"),this.isModalOpen=!0,setTimeout(()=>{a&&a.focus()},100),console.log("✅ Modal aberto")}closeModal(){let e=document.querySelector(".modal-btn"),t=document.querySelector(".modal-overlay"),o=document.querySelector("#modal-toggle");o?o.checked=!1:t.style.display="none",e.setAttribute("aria-expanded","false"),this.isModalOpen=!1,e.focus(),console.log("❌ Modal fechado")}setupAlertNavigation(){document.addEventListener("keydown",e=>{let t=document.querySelector(".alert-educational");t&&(("Enter"===e.key||" "===e.key)&&document.activeElement===t&&(e.preventDefault(),this.toggleAlert(t)),"Escape"===e.key&&t.classList.contains("expanded")&&this.collapseAlert(t))});let e=document.querySelector(".alert-educational");e&&!e.hasAttribute("tabindex")&&(e.setAttribute("tabindex","0"),e.setAttribute("role","button"),e.setAttribute("aria-label","Informa\xe7\xe3o educativa - pressione Enter para expandir"))}toggleAlert(e){if(e.classList.toggle("expanded"),e.classList.contains("expanded")){e.style.width="300px";let t=e.querySelector(".alert-content");t&&(t.style.opacity="1",t.style.maxHeight="500px"),e.setAttribute("aria-expanded","true")}else this.collapseAlert(e)}collapseAlert(e){e.style.width="50px";let t=e.querySelector(".alert-content");t&&(t.style.opacity="0",t.style.maxHeight="0"),e.setAttribute("aria-expanded","false")}setupFormNavigation(){document.addEventListener("keydown",e=>{if("Enter"===e.key&&"INPUT"===e.target.tagName&&"submit"!==e.target.type){e.preventDefault();let t=e.target.closest("form");if(!t)return;let o=Array.from(t.querySelectorAll("input, select, textarea")),a=o.indexOf(e.target);if(a<o.length-1)o[a+1].focus();else{let n=t.querySelector('button[type="submit"]');n&&n.focus()}}}),document.addEventListener("keydown",e=>{if((e.altKey||e.metaKey)&&"s"===e.key){e.preventDefault();let t=document.querySelector("form");if(t){let o=t.querySelector('button[type="submit"]');o&&o.focus()}}})}setupGlobalKeyboardEvents(){document.addEventListener("keydown",e=>{"Tab"===e.key&&(document.body.classList.add("keyboard-user"),document.body.classList.remove("mouse-user"))}),document.addEventListener("mousedown",()=>{document.body.classList.add("mouse-user"),document.body.classList.remove("keyboard-user")}),document.addEventListener("keydown",e=>{if(e.altKey)switch(e.key){case"1":e.preventDefault(),window.location.hash="#/";break;case"2":e.preventDefault(),window.location.hash="#/projetos";break;case"3":e.preventDefault(),window.location.hash="#/cadastro";break;case"0":e.preventDefault();let t=document.querySelector(".skip-link");t&&t.focus()}})}toggleDropdown(e){let t=e.classList.contains("active");t?this.closeDropdown(e):this.openDropdown(e)}openDropdown(e){this.closeAllDropdowns(),e.classList.add("active");let t=e.querySelector(".dropdown-toggle");t&&t.setAttribute("aria-expanded","true"),this.currentDropdown=e,console.log("\uD83D\uDCC2 Dropdown aberto")}closeDropdown(e){e.classList.remove("active");let t=e.querySelector(".dropdown-toggle");t&&t.setAttribute("aria-expanded","false"),this.currentDropdown===e&&(this.currentDropdown=null),console.log("\uD83D\uDCC1 Dropdown fechado")}closeAllDropdowns(){document.querySelectorAll(".dropdown.active").forEach(e=>{this.closeDropdown(e)})}closeCurrentDropdown(){this.currentDropdown&&this.closeDropdown(this.currentDropdown)}focusFirstMenuItem(e){let t=e.querySelector(".dropdown-menu");if(t){let o=t.querySelector("a");o&&(o.focus(),console.log("\uD83D\uDD3D Foco no primeiro item do menu"))}}focusLastMenuItem(e){let t=e.querySelector(".dropdown-menu");if(t){let o=t.querySelectorAll("a");o.length>0&&(o[o.length-1].focus(),console.log("\uD83D\uDD3C Foco no \xfaltimo item do menu"))}}destroy(){this.currentDropdown=null,this.isModalOpen=!1}}const initializeKeyboardNavigation=()=>(window.keyboardNavigationInstance&&window.keyboardNavigationInstance.destroy(),window.keyboardNavigationInstance=new KeyboardNavigation,!0);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeKeyboardNavigation):initializeKeyboardNavigation(),window.addEventListener("hashchange",()=>{setTimeout(()=>{window.keyboardNavigationInstance?(window.keyboardNavigationInstance.setupDropdownNavigation(),window.keyboardNavigationInstance.setupDropdownMenuNavigation(),window.keyboardNavigationInstance.setupModalNavigation()):initializeKeyboardNavigation()},100)});const originalPushState=history.pushState,originalReplaceState=history.replaceState;history.pushState=function(...e){originalPushState.apply(this,e),setTimeout(initializeKeyboardNavigation,50)},history.replaceState=function(...e){originalReplaceState.apply(this,e),setTimeout(initializeKeyboardNavigation,50)},window.KeyboardNavigation=KeyboardNavigation;