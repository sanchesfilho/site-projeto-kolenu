//    PLATAFORMA WEB – ONG
//    DESENVOLVIDO POR: JAYME SANCHES FILHO
//    INSTITUIÇÃO: UNIVERSIDADE CRUZEIRO DO SUL
//    DISCIPLINA: DESENVOLVIMENTO FRONT—END PARA WEB
//    EXPERIÊNCIA PRÁTICA — ENTREGA 4 (VERSIONAMENTO, ACESSIBILIDADE E DEPLOY)
//    DATA: 01/11/2025

//    ARIA-MANAGER.JS — SISTEMA COMPLETO PARA LEITORES DE TELA
//    GERENCIA ATRIBUTOS ARIA, ROLES E ESTADOS DE ACESSIBILIDADE DINÂMICOS

class AriaManager{constructor(){this.observedElements=new Set,this.init()}init(){this.setupAriaAttributes(),this.setupLiveRegions(),this.setupDynamicAriaObservers(),this.setupSPACompatibility(),console.log("✅ ARIA MANAGER INICIALIZADO - SUPORTE LEITORES DE TELA ATIVO")}setupAriaAttributes(){let e=document.querySelector(".alert-educational");e&&(e.setAttribute("role","complementary"),e.setAttribute("aria-label","Informa\xe7\xe3o educativa sobre combate ao antissemitismo"),this.observedElements.add(e));let t=document.querySelector(".toast-auto");t&&(t.setAttribute("role","status"),t.setAttribute("aria-live","polite"),t.setAttribute("aria-atomic","true"));let a=document.querySelector(".modal-overlay"),r=document.querySelector(".modal-content");a&&r&&(a.setAttribute("aria-hidden","true"),r.setAttribute("aria-describedby","modal-desc")),document.querySelectorAll(".footer-sns img").forEach(e=>{e.setAttribute("role","presentation"),e.setAttribute("alt","")}),console.log("\uD83C\uDFAF Atributos ARIA est\xe1ticos configurados")}setupLiveRegions(){if(!document.getElementById("live-region")){let e=document.createElement("div");e.id="live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e)}let t=document.getElementById("app");t&&this.observeContentChanges(t)}observeContentChanges(e){let t=new MutationObserver(e=>{e.forEach(e=>{"childList"===e.type&&e.addedNodes.forEach(e=>{e.nodeType===Node.ELEMENT_NODE&&this.processNewContent(e)})})});t.observe(e,{childList:!0,subtree:!0}),console.log("\uD83D\uDC40 Observador de conte\xfado SPA ativo")}processNewContent(e){let t=e.querySelectorAll?e.querySelectorAll("form"):[];t.forEach(e=>{if(!e.hasAttribute("aria-labelledby")){let t=e.querySelector("legend");t&&!t.id&&(t.id="form-legend-"+Date.now(),e.setAttribute("aria-labelledby",t.id))}});let a=e.querySelectorAll?e.querySelectorAll("section"):[];a.forEach(e=>{if(!e.hasAttribute("aria-labelledby")&&!e.hasAttribute("aria-label")){let t=e.querySelector("h2, h3, h4");t&&!t.id&&(t.id="section-heading-"+Date.now(),e.setAttribute("aria-labelledby",t.id))}}),this.updateActiveNavigation()}updateActiveNavigation(){let e=window.location.hash,t=document.querySelectorAll('.nav-menu a[role="menuitem"]');t.forEach(t=>{let a=t.getAttribute("href");a===e||"#/"===e&&"#/"===a?t.setAttribute("aria-current","page"):t.removeAttribute("aria-current")})}setupDynamicAriaObservers(){this.observeDropdownStates(),this.observeModalStates(),this.observeAlertStates()}observeDropdownStates(){let e=document.querySelectorAll(".dropdown");e.forEach(e=>{let t=new MutationObserver(t=>{t.forEach(t=>{if("class"===t.attributeName){let a=e.classList.contains("active"),r=e.querySelector(".dropdown-toggle"),i=e.querySelector(".dropdown-menu");r&&r.setAttribute("aria-expanded",a.toString()),i&&i.setAttribute("aria-hidden",(!a).toString())}})});t.observe(e,{attributes:!0,attributeFilter:["class"]})})}observeModalStates(){let e=document.querySelector(".modal-overlay"),t=document.querySelector(".modal-btn");if(e&&t){let a=new MutationObserver(a=>{a.forEach(a=>{if("class"===a.attributeName||"style"===a.attributeName){let r=e.classList.contains("active")||"flex"===e.style.display;e.setAttribute("aria-hidden",(!r).toString()),t.setAttribute("aria-expanded",r.toString()),r&&this.trapModalFocus()}})});a.observe(e,{attributes:!0,attributeFilter:["class","style"]})}}observeAlertStates(){let e=document.querySelector(".alert-educational");if(e){let t=new MutationObserver(t=>{t.forEach(t=>{if("class"===t.attributeName){let a=e.classList.contains("expanded");e.setAttribute("aria-expanded",a.toString()),a?this.announceToScreenReader("Informa\xe7\xe3o educativa expandida"):this.announceToScreenReader("Informa\xe7\xe3o educativa recolhida")}})});t.observe(e,{attributes:!0,attributeFilter:["class"]})}}trapModalFocus(){let e=document.querySelector(".modal-content");if(!e)return;let t=e.querySelectorAll('button, [href], input, select, textarea, [tabindex]:not([tabindex="-1"])');t.length>0&&setTimeout(()=>{let t=e.querySelector(".modal-close");t&&t.focus()},100)}announceToScreenReader(e,t="polite"){let a=document.getElementById("live-region");a||((a=document.createElement("div")).id="live-region",a.setAttribute("aria-live",t),a.setAttribute("aria-atomic","true"),a.className="sr-only",document.body.appendChild(a)),a.textContent=e,setTimeout(()=>{a.textContent=""},3e3),console.log("\uD83D\uDDE3️ An\xfancio para leitor de tela:",e)}setupSPACompatibility(){window.addEventListener("hashchange",()=>{setTimeout(()=>{this.updateActiveNavigation(),this.processNewContent(document.getElementById("app"))},100)});let e=history.pushState,t=history.replaceState;history.pushState=function(...t){e.apply(this,t),setTimeout(()=>window.dispatchEvent(new Event("hashchange")),50)},history.replaceState=function(...e){t.apply(this,e),setTimeout(()=>window.dispatchEvent(new Event("hashchange")),50)}}updateAriaState(e,t){e&&(Object.keys(t).forEach(a=>{null===t[a]?e.removeAttribute(a):e.setAttribute(a,t[a])}),this.observedElements.add(e))}destroy(){this.observedElements.clear(),console.log("\uD83E\uDDF9 ARIA Manager destru\xeddo")}}const initializeAriaManager=()=>(window.ariaManagerInstance&&window.ariaManagerInstance.destroy(),window.ariaManagerInstance=new AriaManager,!0);"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initializeAriaManager):initializeAriaManager(),window.addEventListener("hashchange",()=>{setTimeout(()=>{window.ariaManagerInstance?window.ariaManagerInstance.setupAriaAttributes():initializeAriaManager()},150)}),window.AriaManager=AriaManager;